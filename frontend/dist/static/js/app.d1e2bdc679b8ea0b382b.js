webpackJsonp([1,2],{100:function(t,e,a){"use strict";var n=a(240);a.n(n);e.a=n.Bar.extend({props:["data","options"],mounted:function(){this.renderChart(this.data,this.options)}})},133:function(t,e){},134:function(t,e){},135:function(t,e){},136:function(t,e){},241:function(t,e,a){var n=a(5)(a(94),a(252),null,null);t.exports=n.exports},242:function(t,e,a){a(136);var n=a(5)(a(95),a(253),null,null);t.exports=n.exports},243:function(t,e,a){var n=a(5)(a(96),a(248),null,null);t.exports=n.exports},244:function(t,e,a){a(133);var n=a(5)(a(97),a(247),null,null);t.exports=n.exports},245:function(t,e,a){a(135);var n=a(5)(a(98),a(251),null,null);t.exports=n.exports},246:function(t,e,a){var n=a(5)(a(99),a(250),null,null);t.exports=n.exports},247:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.loading?a("p",[t._v("Chargement...")]):a("div",{staticClass:"container"},[a("router-link",{staticClass:"u-pull-right",attrs:{to:"/stats"}},[t._v("Stats >")]),t._v(" "),a("last-updated"),t._v(" "),a("stats",{attrs:{trains:t.trains}}),t._v(" "),a("div",{staticClass:"row"},[a("train-table",{attrs:{id:"retour",trains:t.trains.retour,title:t.infos.to_station+" ➡️ "+t.infos.from_station,anchor:"aller"}}),t._v(" "),a("train-table",{attrs:{id:"aller",trains:t.trains.aller,title:t.infos.from_station+" ➡️ "+t.infos.to_station,anchor:"retour"}})],1)],1)},staticRenderFns:[]}},248:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.loading?a("p",[t._v("Chargement...")]):a("div",{staticClass:"container"},[a("router-link",{attrs:{to:"/"}},[t._v("< Accueil")]),t._v(" "),a("h4",[t._v("Derniers trains (2j), par heure")]),t._v(" "),a("bar-chart",{attrs:{data:t.chartData("lastHours"),options:t.chartOptions,height:200}}),t._v(" "),a("h4",[t._v("Derniers trains (15j), par jour")]),t._v(" "),a("bar-chart",{attrs:{data:t.chartData("lastDays"),options:t.chartOptions,height:200}}),t._v(" "),a("h4",[t._v("Tous les trains, par heure, agrégé")]),t._v(" "),a("bar-chart",{attrs:{data:t.chartData("hourOverall"),options:t.chartOptions,height:200}}),t._v(" "),a("h4",[t._v("Tous les trains, par jour de la semaine")]),t._v(" "),a("bar-chart",{attrs:{data:t.chartData("weekday"),options:t.chartOptions,height:200}}),t._v(" "),a("h4",[t._v("Tous les trains, par mois")]),t._v(" "),a("bar-chart",{attrs:{data:t.chartData("month"),options:t.chartOptions,height:200}}),t._v(" "),a("h4",[t._v("Tous les trains, par jour")]),t._v(" "),a("bar-chart",{attrs:{data:t.chartData("day"),options:t.chartOptions,height:200}})],1)},staticRenderFns:[]}},249:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},staticRenderFns:[]}},250:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"six columns"},[a("h4",{attrs:{id:t.id}},[t._v(t._s(t.title))]),t._v(" "),a("a",{staticClass:"navigation",attrs:{href:t.anchorLink}},[t._v(t._s(t.anchorText))]),t._v(" "),a("table",{staticClass:"pure-table"},[t._m(0),t._v(" "),a("tbody",t._l(t.trains,function(t){return a("train-row",{attrs:{train:t}})}))])])},staticRenderFns:[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",[a("tr",[a("th",[t._v("Date")]),t._v(" "),a("th",[t._v("Circulation")]),t._v(" "),a("th",[t._v("Retard")])])])}]}},251:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("tr",{class:{canceled:"SUPPR"===t.train.type}},[a("td",[t._v(t._s(t.train.date))]),t._v(" "),a("td",{class:{alert:"NORMAL"!==t.train.type}},[t._v(t._s(t.train.type))]),t._v(" "),a("td",[t.train.delay?a("span",[t._v(t._s(t.train.delay)+"s")]):t._e()])])},staticRenderFns:[]}},252:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pure-u-1 refreshing"},[t._v("Mise à jour il y a "+t._s(t.lastUpdatedSeconds)+" sec.")])},staticRenderFns:[]}},253:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"row stats"},[a("div",{staticClass:"twelve columns"},[a("span",{staticClass:"normal"},[t._v("Normal "),a("span",{staticClass:"number"},[t._v(t._s(t.nbTrainsByType("NORMAL")))])]),t._v(" "),a("span",{staticClass:"suppr"},[t._v("Suppr. "),a("span",{staticClass:"number"},[t._v(t._s(t.nbTrainsByType("SUPPR")))])]),t._v(" "),a("span",{staticClass:"late"},[t._v("Retard "),a("span",{staticClass:"number"},[t._v(t._s(t.nbTrainsByType("RETARD")))])]),t._v(" "),a("span",{staticClass:"total"},[t._v("Total "),a("span",{staticClass:"number"},[t._v(t._s(t.nbTrainsByType()))])]),t._v(" "),a("span",{staticClass:"health"},[t._v("Santé "),a("span",{staticClass:"number"},[t._v(t._s(t.health))]),t._v("%")])])])},staticRenderFns:[]}},257:function(t,e){},258:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(16),r=a.n(n),s=a(92),i=a.n(s),o=a(89),u=(a.n(o),a(90)),c=(a.n(u),a(91)),l=a.n(c),d=a(87),p=a(88);r.a.use(i.a),new r.a({el:"#app",router:d.a,store:p.a,template:"<App/>",components:{App:l.a}})},47:function(t,e,a){"use strict";var n=a(16),r=a.n(n);e.a={query:function(t){var e="/api";return t&&(e+="?since="+t),r.a.http.get(e).then(function(t){return t.body}).catch(function(t){console.error("Error fetching trains:",t)})},queryAggregate:function(t,e){var a="/api/aggregate/"+t;return e&&(a+="?since="+e),r.a.http.get(a).then(function(t){return t.body}).catch(function(t){console.error("Error fetching aggregate:",t)})}}},87:function(t,e,a){"use strict";var n=a(16),r=a.n(n),s=a(254),i=a.n(s),o=a(244),u=a.n(o),c=a(243),l=a.n(c);r.a.use(i.a),e.a=new i.a({routes:[{path:"/",name:"Timetable",component:u.a},{path:"/stats",name:"StatsPage",component:l.a}],mode:"history"})},88:function(t,e,a){"use strict";var n=a(48),r=a.n(n),s=a(16),i=a.n(s),o=a(256),u=a.n(o),c=a(239),l=a.n(c),d=a(47);i.a.use(u.a),e.a=new u.a.Store({state:{infos:{},trains:{aller:[],retour:[]},lastHistoryDate:void 0,lastUpdated:void 0},mutations:{add:function(t,e){e.aller.length&&(t.trains.aller=l()(e.aller,t.trains.aller,"id"),t.trains.aller=[].concat(r()(t.trains.aller))),e.retour.length&&(t.trains.retour=l()(e.retour,t.trains.retour,"id"),t.trains.retour=[].concat(r()(t.trains.retour))),t.infos=e.infos},recordLastUpdated:function(t){t.lastUpdated=Date.now()/1e3|0}},actions:{fetch:function(t){return d.a.query(t.state.lastUpdated).then(function(e){t.commit("add",e),t.commit("recordLastUpdated")})}}})},89:function(t,e){},90:function(t,e){},91:function(t,e,a){a(134);var n=a(5)(a(93),a(249),null,null);t.exports=n.exports},93:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"app"}},94:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"last-updated",data:function(){return{lastUpdatedSeconds:0}},computed:{lastUpdated:function(){return this.$store.state.lastUpdated}},created:function(){var t=this;setInterval(function(){t.lastUpdated&&(t.lastUpdatedSeconds=(Date.now()/1e3|0)-t.lastUpdated)},1e3)}}},95:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(48),r=a.n(n);e.default={name:"stats",props:["trains"],computed:{allTrains:function(){return[].concat(r()(this.trains.aller),r()(this.trains.retour))},health:function(){var t=(this.nbTrainsByType("RETARD")+2*this.nbTrainsByType("SUPPR"))/(this.nbTrainsByType()+this.nbTrainsByType("SUPPR"));return parseInt(100*(1-t))}},methods:{nbTrainsByType:function(t){return t?this.allTrains.filter(function(e){return e.type===t}).length:this.allTrains.length}}}},96:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(102),r=a.n(n),s=a(228),i=(a.n(s),a(232)),o=(a.n(i),a(47)),u=a(100);e.default={name:"timetable",components:{"bar-chart":u.a},data:function(){return{stats:{month:[],year:[],day:[],lastHours:[],lastDays:[],hourOverall:[],weekday:[]},loading:!0,chartOptions:{scales:{xAxes:[{stacked:!0,barPercentage:1}],yAxes:[{stacked:!0}]}},types:[{name:"late",color:"#ff9849",title:"Retard"},{name:"suppr",color:"#ff5555",title:"Supprimé"},{name:"normal",color:"#27c795",title:"Normal"}],frequencies:[{name:"month",url:"month"},{name:"day",url:"day"},{name:"hourOverall",url:"hour_overall"},{name:"weekday",url:"weekday"},{name:"lastHours",url:"hour",since:(new Date).setDate((new Date).getDate()-2)/1e3|0},{name:"lastDays",url:"day",since:(new Date).setDate((new Date).getDate()-7)/1e3|0}]}},methods:{groupStats:function(t){var e=[];return t.forEach(function(t){e.indexOf(t.date)===-1&&e.push(t.date)}),e.map(function(e){return{date:e,values:t.filter(function(t){return t.date===e}).reduce(function(t,e){return{late:"RETARD"===e.type?e.count:t.late,suppr:"SUPPR"===e.type?e.count:t.suppr,normal:"NORMAL"===e.type?e.count:t.normal}},{late:0,suppr:0,normal:0})}})},chartData:function(t){var e=this.stats[t];if(!e)return void console.error("Unknown frequency",t);var a=this.groupStats(e),n=this.types.map(function(t){return{label:t.title,backgroundColor:t.color,data:a.map(function(e){return e.values[t.name]})}}),r=void 0;return r="weekday"===t?["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"]:a.map(function(t){return t.date.toString().replace(":","h")}),{labels:r,datasets:n}},getData:function(){var t=this,e=[];return this.frequencies.forEach(function(a){e.push(o.a.queryAggregate(a.url,a.since).then(function(e){t.stats[a.name]=e}))}),e}},created:function(){var t=this;r.a.all(this.getData()).then(function(){t.loading=!1})}}},97:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(246),r=a.n(n),s=a(241),i=a.n(s),o=a(242),u=a.n(o);e.default={name:"timetable",components:{"train-table":r.a,"last-updated":i.a,stats:u.a},data:function(){return{loading:!0,refreshing:!1}},computed:{trains:function(){return this.$store.state.trains},infos:function(){return this.$store.state.infos}},created:function(){var t=this;this.$store.dispatch("fetch").then(function(){t.loading=!1,setInterval(function(){t.refreshing=!0,t.$store.dispatch("fetch").then(function(){t.refreshing=!1})},3e4)})}}},98:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"train-row",props:["train"]}},99:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(245),r=a.n(n);e.default={name:"train-table",computed:{anchorLink:function(){return"#"+this.anchor},anchorText:function(){return this.anchor.charAt(0).toUpperCase()+this.anchor.slice(1)}},components:{"train-row":r.a},props:["title","trains","anchor","id"]}}},[258]);